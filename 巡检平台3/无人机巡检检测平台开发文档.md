# 无人机巡检检测平台开发文档

## 文档前言

### 项目背景
无人机巡检检测平台旨在解决传统人工巡检效率低、成本高、安全风险大等问题。平台通过"任务调度 - 设备控制 - 数据采集 - AI识别 - 可视化管理"全流程自动化，实现对建筑等基础设施的智能化巡检。

### 文档用途
本文档面向全栈开发工程师，提供平台核心功能的技术实现指导，确保开发团队能够准确理解业务需求并落地实现。文档基于界面模块布局和三层架构设计，具备技术落地性和实操指导性。

### 适用人群
- 全栈开发工程师
- 前端开发工程师（Vue3 + Three.js）
- 后端开发工程师（.NET 6.0 + Furion）
- 项目技术负责人

### 版本说明
- 文档版本：v1.0
- 技术栈版本：.NET 6.0 + Vue3 + MySQL
- 更新日期：2025年10月

---

## 技术架构设计

### 分层架构说明

#### 前端展示层
**技术栈**：Vue3 + TypeScript + Element Plus + Three.js + Cesium/MapBox
**职责**：
- 用户界面展示和交互
- 3D模型渲染和地图可视化
- 实时数据展示和图表绘制
- 用户操作响应和状态管理

#### 应用服务层
**技术栈**：.NET 6.0 + Furion框架
**职责**：
- 业务逻辑处理和流程控制
- 用户认证和权限管理
- API接口提供和数据校验
- 任务调度和状态管理

#### 服务平台层
**核心服务模块**：
- **任务调度服务**：管理巡检任务的创建、执行、监控
- **设备管理服务**：处理无人机状态监控和控制指令
- **文件存储服务**：管理影像、模型等大文件的存储
- **API集成服务**：封装DJI上云API、AI识别接口等第三方服务
- **消息通知服务**：处理告警推送和系统通知

#### 数据存储层
**技术栈**：MySQL/SQL Server + SqlSugar ORM
**数据分类**：
- **业务数据**：用户、任务、设备、工单等结构化数据
- **文件数据**：巡检影像、3D模型、报告文档
- **日志数据**：操作日志、设备日志、系统监控数据

### 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           前端展示层 (Presentation Layer)                        │
│                Vue3 + TypeScript + Element Plus + Three.js + Cesium            │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────────────┐ │
│  │  系统管理    │   航线管理   │   设备控制   │   AI识别    │    数据可视化        │ │
│  │  界面模块    │   界面模块   │   界面模块   │   界面模块   │    界面模块         │ │
│  │ ·用户登录    │ ·地图绘制    │ ·实时监控    │ ·图像上传    │ ·3D模型展示        │ │
│  │ ·权限管理    │ ·航点编辑    │ ·指令控制    │ ·结果标注    │ ·统计图表          │ │
│  │ ·系统配置    │ ·参数设置    │ ·状态展示    │ ·工单管理    │ ·数据大屏          │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │ HTTP/WebSocket
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            应用服务层 (Application Layer)                        │
│                        .NET 6.0 + Furion + Web API                            │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────────────┐ │
│  │  用户服务    │   任务服务   │   设备服务   │  AI识别服务  │    数据服务         │ │
│  │ UserService │ TaskService │DeviceService│  AIService  │   DataService       │ │
│  │ ·身份认证    │ ·任务调度    │ ·状态监控    │ ·图像识别    │ ·文件管理          │ │
│  │ ·权限验证    │ ·航线管理    │ ·指令下发    │ ·异常检测    │ ·报表生成          │ │
│  │ ·用户管理    │ ·进度跟踪    │ ·告警处理    │ ·工单流程    │ ·统计分析          │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │ 服务调用
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        服务平台层 (Service Platform Layer)                       │
│                          基础服务封装与第三方集成                                │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────────────┐ │
│  │ 任务调度服务  │ 文件存储服务  │ API集成服务  │  消息通知服务 │   监控日志服务       │ │
│  │ScheduleService│FileService │ ApiService  │NotifyService│  MonitorService     │ │
│  │ ·定时任务    │ ·文件上传    │ ·DJI API    │ ·邮件推送    │ ·性能监控          │ │
│  │ ·任务队列    │ ·存储管理    │ ·AI接口     │ ·短信通知    │ ·错误日志          │ │
│  │ ·状态同步    │ ·缓存处理    │ ·地图服务    │ ·站内消息    │ ·操作审计          │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │ 数据访问
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             数据存储层 (Data Layer)                             │
│                        MySQL/SQL Server + SqlSugar ORM                        │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────────────┐ │
│  │   业务数据   │   任务数据   │   设备数据   │   文件数据   │    日志数据         │ │
│  │   用户表     │   任务表     │   设备表     │   影像表     │    操作日志         │ │
│  │ ·用户信息    │ ·任务记录    │ ·设备状态    │ ·巡检影像    │ ·系统日志          │ │
│  │ ·角色权限    │ ·航线数据    │ ·飞行轨迹    │ ·3D模型     │ ·错误日志          │ │
│  │ ·系统配置    │ ·执行结果    │ ·告警记录    │ ·AI结果     │ ·审计日志          │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │ 外部接口
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              第三方服务层 (External Services)                    │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────────────┐ │
│  │  DJI上云API  │  AI识别服务  │   地图服务   │  消息推送    │    其他服务         │ │
│  │ ·设备管理    │ ·图像识别    │ ·底图服务    │ ·邮件服务    │ ·天气服务          │ │
│  │ ·任务控制    │ ·缺陷检测    │ ·路径规划    │ ·短信服务    │ ·存储服务          │ │
│  │ ·数据同步    │ ·结果分析    │ ·坐标转换    │ ·推送服务    │ ·备份服务          │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 层间交互逻辑

**数据流向说明**：
```
用户操作 → 前端组件 → HTTP/WebSocket → 应用服务层 → 服务平台层 → 数据存储层
                                    ↓
实时推送 ← WebSocket ← 消息服务 ← 第三方API ← 外部系统
```

**关键交互说明**：
- **前端 ↔ 应用层**：RESTful API + WebSocket实时通信
- **应用层 ↔ 服务层**：内部服务调用，统一异常处理
- **服务层 ↔ 数据层**：ORM数据访问，连接池管理
- **服务层 ↔ 第三方**：API集成，熔断降级机制

### 业务流程架构图

```
                            无人机巡检检测平台业务流程图
                                    
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │   用户登录   │───▶│   权限验证   │───▶│   角色判断   │
    └─────────────┘    └─────────────┘    └─────┬───────┘
                                                │
                    ┌───────────────────────────┼───────────────────────────┐
                    │                           │                           │
                    ▼                           ▼                           ▼
            ┌─────────────┐            ┌─────────────┐            ┌─────────────┐
            │   管理员     │            │   巡检员     │            │   查看员     │
            │  系统管理    │            │  任务管理    │            │  数据查看    │
            └─────────────┘            └─────┬───────┘            └─────────────┘
                                             │
                                             ▼
                                    ┌─────────────┐
                                    │ 创建巡检任务 │
                                    └─────┬───────┘
                                          │
                                          ▼
                                    ┌─────────────┐
                                    │ 设计航线路径 │
                                    └─────┬───────┘
                                          │
                                          ▼
                                    ┌─────────────┐
                                    │ 选择执行设备 │
                                    └─────┬───────┘
                                          │
                                          ▼
                                    ┌─────────────┐
                                    │ 设置任务参数 │
                                    └─────┬───────┘
                                          │
                                          ▼
                                    ┌─────────────┐
                                    │ 提交任务调度 │
                                    └─────┬───────┘
                                          │
                                          ▼
                                    ┌─────────────┐
                                    │ 设备状态检查 │
                                    └─────┬───────┘
                                          │
                    ┌─────────────────────┼─────────────────────┐
                    │                     │                     │
                    ▼                     ▼                     ▼
            ┌─────────────┐      ┌─────────────┐      ┌─────────────┐
            │  设备可用    │      │  设备忙碌    │      │  设备异常    │
            │ 启动巡检任务 │      │ 任务排队等待 │      │ 任务失败告警 │
            └─────┬───────┘      └─────────────┘      └─────────────┘
                  │
                  ▼
            ┌─────────────┐
            │ 实时监控飞行 │
            └─────┬───────┘
                  │
                  ▼
            ┌─────────────┐
            │ 数据采集上传 │
            └─────┬───────┘
                  │
                  ▼
            ┌─────────────┐
            │ AI智能识别  │
            └─────┬───────┘
                  │
                  ▼
            ┌─────────────┐
            │  发现异常?   │
            └─────┬───────┘
                  │
        ┌─────────┼─────────┐
        │         │         │
        ▼         ▼         ▼
   ┌─────────┐ ┌─────────┐ ┌─────────────┐
   │   是     │ │   否     │ │  正常完成    │
   │生成异常告警│ │正常完成任务│ │  任务       │
   └────┬────┘ └────┬────┘ └─────┬───────┘
        │           │            │
        ▼           │            │
   ┌─────────────┐  │            │
   │ 创建处理工单 │  │            │
   └─────┬───────┘  │            │
         │          │            │
         ▼          │            │
   ┌─────────────┐  │            │
   │ 分派处理人员 │  │            │
   └─────┬───────┘  │            │
         │          │            │
         ▼          │            │
   ┌─────────────┐  │            │
   │ 现场处理确认 │  │            │
   └─────┬───────┘  │            │
         │          │            │
         ▼          │            │
   ┌─────────────┐  │            │
   │ 工单结果归档 │  │            │
   └─────┬───────┘  │            │
         │          │            │
         └──────────┼────────────┘
                    │
                    ▼
            ┌─────────────┐
            │ 数据整理归档 │
            └─────┬───────┘
                  │
                  ▼
            ┌─────────────┐
            │ 生成巡检报告 │
            └─────┬───────┘
                  │
                  ▼
            ┌─────────────┐
            │ 数据可视化展示│
            └─────────────┘
```

**核心业务流程说明**：

1. **用户认证流程**：登录验证 → 权限分配 → 功能模块访问
2. **任务创建流程**：航线设计 → 设备选择 → 参数配置 → 任务提交
3. **任务执行流程**：设备检查 → 任务启动 → 实时监控 → 数据采集
4. **异常处理流程**：AI识别 → 异常告警 → 工单创建 → 处理跟踪
5. **数据管理流程**：数据归档 → 报告生成 → 可视化展示

---

## 开发环境搭建

### 前端环境要求

**基础环境**：
- Node.js 16.x 或以上版本
- npm 8.x 或 yarn 1.22.x

**项目初始化**：
```bash
# 创建Vue3项目
npm create vue@latest drone-inspection-frontend
cd drone-inspection-frontend
npm install

# 安装核心依赖
npm install element-plus three cesium @cesium/engine
npm install @types/three --save-dev
```

**关键配置文件**：
- `.env.development`：开发环境API地址、地图密钥
- `vite.config.ts`：Cesium资源配置、代理设置
- `tsconfig.json`：TypeScript编译配置

### 后端环境要求

**基础环境**：
- .NET 6.0 SDK
- Visual Studio 2022 或 VS Code
- MySQL 8.0 或 SQL Server 2019

**项目创建**：
```bash
# 安装Furion模板
dotnet new install Furion.Template.App
# 创建项目
dotnet new furion -n DroneInspectionPlatform
```

**核心配置**：
- `appsettings.json`：数据库连接字符串、JWT配置
- `Program.cs`：中间件配置、服务注册
- Swagger文档：`http://localhost:5000/swagger`

### 第三方服务准备

**DJI上云API**：
- 申请开发者账号和API密钥
- 配置回调地址和权限范围

**AI识别服务**：
- 准备图像识别API接口
- 配置识别模型和置信度阈值

**地图服务**：
- 申请Cesium Ion访问令牌
- 或配置MapBox API密钥

---

## 核心模块功能需求

### 1. 系统管理模块

**对应界面**：系统管理页面
**核心功能**：

#### 用户认证与授权
- **登录功能**：用户名/密码登录，支持记住密码
- **角色管理**：管理员、巡检员、查看员三级权限
- **权限控制**：基于角色的模块访问权限和数据查看权限
- **会话管理**：JWT Token自动刷新，异地登录检测

#### 系统配置
- **基础参数**：系统名称、Logo、联系方式
- **业务配置**：巡检区域设置、设备类型管理
- **安全设置**：密码策略、登录限制、操作日志

**前端实现要点**：
- 使用Element Plus表单组件构建登录界面
- Pinia状态管理存储用户信息和权限
- 路由守卫实现页面访问控制

**后端实现要点**：
- Furion JWT认证中间件配置
- 基于Attribute的权限验证
- SqlSugar实现用户和角色的CRUD操作

### 2. 任务管理与设备控制模块

**对应界面**：航线管理、设备控制页面

#### 航线管理功能
- **地图操作**：在GIS地图上绘制航点和航线
- **参数配置**：飞行高度、速度、拍摄间隔、重叠率
- **航线验证**：检查航线合理性、禁飞区冲突
- **模板管理**：保存常用航线模板，支持复用

#### 设备监控功能
- **实时状态**：电池电量、GPS位置、飞行状态
- **远程控制**：起飞、降落、返航、暂停指令
- **告警处理**：低电量、失联、异常状态告警
- **历史轨迹**：设备飞行轨迹回放和分析

#### 任务调度功能
- **任务创建**：关联航线、设备、执行时间
- **冲突检测**：时间冲突、区域冲突、设备占用检测
- **状态流转**：待执行→执行中→已完成→异常中断
- **进度监控**：实时显示任务执行进度和剩余时间

**技术实现要点**：
- Cesium地图组件实现航点绘制和编辑
- WebSocket实现设备状态实时推送
- 定时任务处理任务调度和状态同步

### 3. AI识别与异常管理模块

**对应界面**：AI识别、工单管理页面

#### AI识别功能
- **图像上传**：支持批量上传巡检照片
- **自动识别**：调用AI接口识别缺陷和异常
- **结果标注**：在图片上标注识别结果和置信度
- **人工审核**：支持人工确认或修正AI识别结果

#### 异常告警功能
- **告警生成**：基于AI识别结果自动生成告警
- **等级分类**：紧急、重要、一般三级告警分类
- **推送通知**：邮件、短信、站内信多渠道通知
- **统计分析**：告警趋势分析和热点区域统计

#### 工单管理功能
- **工单创建**：基于告警自动或手动创建工单
- **任务分派**：指定处理人员和处理时限
- **进度跟踪**：处理中、已完成、已关闭状态管理
- **结果归档**：处理结果、现场照片、报告存档

**技术实现要点**：
- 文件上传组件支持大文件分片上传
- Canvas或Fabric.js实现图片标注功能
- 消息队列处理AI识别任务的异步处理

### 4. 数据采集与可视化模块

**对应界面**：数据管理、数据大屏页面

#### 数据管理功能
- **影像管理**：巡检照片的分类、检索、预览、下载
- **模型管理**：倾斜摄影3D模型的导入、展示、版本管理
- **数据统计**：按时间、区域、设备维度的数据统计
- **导出功能**：支持Excel、PDF格式的报告导出

#### 可视化大屏功能
- **实时监控**：设备在线状态、任务执行情况
- **统计图表**：任务完成率、异常分布、趋势分析
- **地图展示**：设备位置、巡检区域、告警热点
- **数据刷新**：支持自动刷新和手动刷新

**技术实现要点**：
- Three.js加载和渲染3D Tiles格式模型
- Chart.js或ECharts绘制各类统计图表
- 大文件存储采用分布式文件系统

### 5. 第三方API集成模块

#### DJI上云API集成
- **设备管理**：获取设备列表、状态查询、控制指令
- **航线同步**：上传航线到DJI云端、下载云端航线
- **任务执行**：远程启动任务、监控执行进度
- **数据下载**：自动下载巡检完成后的影像数据

#### AI识别接口集成
- **图像预处理**：图片格式转换、尺寸调整、质量优化
- **识别调用**：异步调用AI接口，处理识别结果
- **结果解析**：解析识别结果，提取缺陷位置和类型
- **置信度过滤**：根据置信度阈值过滤识别结果

#### 地图服务集成
- **底图加载**：卫星影像、地形图、街道图切换
- **坐标转换**：WGS84、GCJ02等坐标系统转换
- **地理编码**：地址转坐标、坐标转地址服务
- **路径规划**：最优航线规划和避障路径计算

---

## 接口规范设计

### 设计原则
- **RESTful风格**：使用标准HTTP方法（GET/POST/PUT/DELETE）
- **统一路径**：`/api/v1/[模块名]/[资源名]`格式
- **版本控制**：通过URL路径进行API版本管理
- **状态码**：标准HTTP状态码 + 自定义业务状态码

### 统一响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2025-10-23T10:30:00Z"
}
```

### 核心接口列表

#### 系统管理接口
- `POST /api/v1/auth/login` - 用户登录
- `POST /api/v1/auth/logout` - 用户登出  
- `GET /api/v1/users` - 获取用户列表
- `POST /api/v1/users` - 创建用户
- `PUT /api/v1/users/{id}` - 更新用户信息

#### 任务管理接口
- `GET /api/v1/tasks` - 获取任务列表
- `POST /api/v1/tasks` - 创建巡检任务
- `PUT /api/v1/tasks/{id}/status` - 更新任务状态
- `GET /api/v1/routes` - 获取航线列表
- `POST /api/v1/routes` - 创建航线

#### 设备控制接口
- `GET /api/v1/devices` - 获取设备列表
- `GET /api/v1/devices/{id}/status` - 获取设备状态
- `POST /api/v1/devices/{id}/control` - 发送控制指令
- `GET /api/v1/devices/{id}/logs` - 获取设备日志

#### AI识别接口
- `POST /api/v1/ai/upload` - 上传识别图片
- `GET /api/v1/ai/results/{taskId}` - 获取识别结果
- `POST /api/v1/ai/confirm` - 确认识别结果
- `GET /api/v1/alerts` - 获取告警列表

#### 数据管理接口
- `GET /api/v1/images` - 获取影像列表
- `POST /api/v1/images/upload` - 上传影像文件
- `GET /api/v1/models` - 获取3D模型列表
- `GET /api/v1/statistics/dashboard` - 获取大屏统计数据

### 接口认证
- **JWT Token**：请求头携带 `Authorization: Bearer {token}`
- **Token刷新**：自动刷新机制，避免频繁登录
- **权限验证**：基于角色的接口访问权限控制

---

## 测试与部署策略

### 测试策略

#### 单元测试
- **前端测试**：使用Vitest测试Vue组件和工具函数
- **后端测试**：使用xUnit测试业务逻辑和数据访问
- **覆盖率要求**：核心业务逻辑覆盖率不低于80%

#### 集成测试
- **API测试**：使用Postman或自动化脚本测试接口
- **端到端测试**：使用Cypress测试完整业务流程
- **第三方集成**：重点测试DJI API和AI接口的稳定性

#### 性能测试
- **前端性能**：3D模型加载速度、大数据量渲染性能
- **后端性能**：高并发接口响应时间、数据库查询优化
- **文件上传**：大文件分片上传的稳定性和速度

### 部署流程

#### 前端部署
- **构建打包**：`npm run build`生成dist目录
- **静态资源**：部署到Nginx或CDN
- **环境配置**：生产环境API地址和密钥配置

#### 后端部署
- **容器化**：使用Docker打包应用和依赖
- **服务部署**：部署到Linux服务器或Kubernetes集群
- **负载均衡**：使用Nginx实现多实例负载均衡

#### 数据库部署
- **初始化**：执行数据库脚本创建表结构
- **数据迁移**：使用Entity Framework Migration
- **备份策略**：定时备份和异地备份机制

#### 生产环境配置
- **安全配置**：HTTPS证书、防火墙规则
- **监控告警**：应用性能监控、错误日志收集
- **扩容策略**：基于负载的自动扩容机制

### 运维监控
- **应用监控**：接口响应时间、错误率、吞吐量
- **系统监控**：CPU、内存、磁盘、网络使用率
- **业务监控**：任务执行成功率、设备在线率、告警处理时效

---

## 附录

### 技术栈版本说明
- 前端：Vue 3.3+、TypeScript 5.0+、Element Plus 2.4+
- 后端：.NET 6.0、Furion 4.8+、SqlSugar 5.1+
- 数据库：MySQL 8.0 或 SQL Server 2019
- 部署：Docker、Nginx、Linux CentOS 7+

### 开发规范
- **代码规范**：ESLint + Prettier（前端）、StyleCop（后端）
- **Git规范**：GitFlow工作流，Commit Message规范
- **文档规范**：接口文档、代码注释、部署文档

### 项目里程碑
- **阶段一**：基础框架搭建、用户管理、权限控制
- **阶段二**：任务管理、设备控制、航线管理
- **阶段三**：AI识别、异常管理、工单流程
- **阶段四**：数据可视化、大屏展示、性能优化
- **阶段五**：第三方集成、测试部署、上线运行

---

*本文档将根据项目进展和需求变更持续更新维护*
